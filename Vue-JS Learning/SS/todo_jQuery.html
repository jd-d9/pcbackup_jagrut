<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo_jQuery</title>
    <!-- external css links -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- external js links -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <!-- internal styles -->
    <style>
        .main{
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px gray;
        }
        .managepart{
            background: linear-gradient(45deg, rgb(120, 219, 255),rgba(120, 219, 255,0.7), rgba(148, 120, 247,0.7));
            color: white !important;
        }
        .managepart i{
            font-size: 65px;
        }
        .managepart h2{
            font-size: 40px;
            line-height: 1.5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bolder;
        }
        .addButton,.submitButton{
            background-color: rgb(148, 120, 247);
            padding: 5px 18px !important;
            font-size: 20px;
            color: white;
        }
        .addButton:hover,.submitButton:hover{
            color: white;
            box-shadow: 0 0 8px rgba(148, 120, 247,0.7);
            transition: all 0.3s;
        }
        .tabletag thead th,.tabletag tbody td{
            padding: 15px;
        }
        .tabletag thead th{
            font-size: 22px;
        }
        .tableBody tr td{
            font-size: 20px;
            color: rgb(94, 94, 94);
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }
        .dropdown-toggle::after{
            display: none;
        }
        .dropdown-toggle:focus{
            box-shadow: none;
        }
        .dropdown-menu{
            transform: translate(-155px, 15px) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row mt-5">
            <div class="col-md-8 mx-auto mt-5">
                <div class="main">
                    <div class="managepart p-5 d-flex justify-content-between align-items-center">
                        <div>
                            <h2>Your Details</h2>
                            <button class="btn addButton mt-2">Add</button>
                        </div>
                        <i class="fa-solid fa-file-lines"></i>
                    </div>
                    <div class="tabletag p-5">
                        <table class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th class="text-end">More</th>
                                </tr>
                            </thead>
                            <tbody class="tableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Modal start here-->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="staticBackdropLabel">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content p-4">
                            <div class="modal-header">
                                <h5 class="modal-title" id="staticBackdropLabel">Add Details</h5>
                                <button type="button" class="btn-close closeButton"></button>
                            </div>
                            <div class="modal-body">
                                <!-- form start here -->
                                <form id="detailsForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div>
                                                <label for="firstNameInput" class="form-label">First Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" placeholder="Enter first name" id="firstNameInput">
                                                <em class="text-danger" id="fNameError"></em>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div>
                                                <label for="lastNameInput" class="form-label">Last Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" placeholder="Enter last name" id="lastNameInput">
                                                <em class="text-danger" id="lNameError"></em>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div>
                                                <label for="emailInput" class="form-label">Mail Id <span class="text-danger">*</span></label>
                                                <input type="email" class="form-control" placeholder="Enter your email" id="emailInput">
                                                <em class="text-danger" id="emailError"></em>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div>
                                                <label for="phonrNumberInput" class="form-label">Phone No <span class="text-danger">*</span></label>
                                                <input type="tel" class="form-control" placeholder="Enter mobile number" id="phonrNumberInput">
                                                <em class="text-danger" id="phoneError"></em>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-12 mb-3">
                                            <div>
                                                <label for="addressInput" class="form-label">Address <span class="text-danger">*</span></label>
                                                <textarea class="form-control" rows="4" placeholder="Enter your address" id="addressInput"></textarea>
                                                <em class="text-danger" id="addressError"></em>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div>
                                                <label for="dobInput" class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                                <input type="date" class="form-control" id="dobInput">
                                                <em class="text-danger" id="dateError"></em>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn submitButton w-100">Submit</button>
                                </form>
                                <!-- form end here -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal end here-->
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            let personDetails = [];
            let personObject = {};
            let getLocalData = JSON.parse(localStorage.getItem('person'));
            getLocalData ? personDetails = getLocalData : localStorage.setItem('person',JSON.stringify(personDetails = []));
            // set data in local storage
            function setLocalData() {
                localStorage.setItem('person',JSON.stringify(personDetails));
            }
            // clear input field value 
            function clearInputValue() {
                $('input').val('').removeAttr('readonly').css('border','');
                $('#addressInput').val('').removeAttr('readonly').css('border','');
                $('em').hide();
                $('#staticBackdropLabel').text('Add Details');
                $('.submitButton').css('display','block').text('Submit');
            }
            let forEditDataToggle = false;
            // modal show
            function modalOpen() {
                $('#staticBackdrop').modal('show');
            }
            // modal hide
            function modalClose() {
                $('#staticBackdrop').modal('hide');
                clearInputValue();
                forEditDataToggle = false;
            }
            $(".addButton").click(() => {
                modalOpen();
                forEditDataToggle = false;
            });
            $(".closeButton").click(modalClose);

            // -------- form validation start ---------
            $('#fNameError').hide();
            $('#lNameError').hide();
            $('#emailError').hide();
            $('#phoneError').hide();
            $('#addressError').hide();
            $('#dateError').hide();

            let errorFname = false;
            let errorLname = false;
            let errorEmail = false;
            let errorPhone = false;
            let errorAddress = false;
            let errorDate = false;

            $('#firstNameInput').focusout((e) => {
                checkFname(e.target.value);
            });
            $('#lastNameInput').focusout((e) => {
                checkLname(e.target.value);
            });
            $('#emailInput').focusout((e) => {
                checkEmail(e.target.value);
            });
            $('#phonrNumberInput').focusout((e) => {
                checkPhone(e.target.value);
            });
            $('#addressInput').focusout((e) => {
                checkAddress(e.target.value);
            });
            $('#dobInput').focusout((e) => {
                checkDate(e.target.value);
            });

            function checkFname(fNameVal) {
                const existingFname = personDetails.filter((value) => {
                    return (value.fName).toLowerCase() == fNameVal.toLowerCase();
                });
                const fnamePattern = /^[a-zA-Z]*$/;
                if(fnamePattern.test(fNameVal) && fNameVal != '' && existingFname.length == 0){
                    $('#fNameError').hide();
                    $('#firstNameInput').css('border','');
                }
                else{
                    $('#fNameError').html('Please enter first name or check for already exist or not !').show();
                    $('#firstNameInput').css('border','1px solid red');
                    errorFname = true;
                }
            }
            function checkLname(lNameVal) {
                const existingLname = personDetails.filter((value) => {
                    return (value.lName).toLowerCase() == lNameVal.toLowerCase();
                });
                const lnamePattern = /^[a-zA-Z]*$/;
                if(lnamePattern.test(lNameVal) && lNameVal != '' && existingLname.length == 0){
                    $('#lNameError').hide();
                    $('#lastNameInput').css('border','');
                }
                else{
                    $('#lNameError').html('Please enter last name or check for already exist or not !').show();
                    $('#lastNameInput').css('border','1px solid red');
                    errorLname = true;
                }
            }
            function checkEmail(mailVal) {
                const existingMail = personDetails.filter((value) => {
                    return (value.mailId).toLowerCase() == mailVal.toLowerCase();
                });
                const mailPattern = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
                if(mailPattern.test(mailVal) && mailVal != '' && existingMail.length == 0){
                    $('#emailError').hide();
                    $('#emailInput').css('border','');
                }
                else{
                    $('#emailError').html('Please enter valid email or check for already exist or not !').show();
                    $('#emailInput').css('border','1px solid red');
                    errorEmail = true;
                }
            }
            function checkPhone(phoneVal) {
                const existingPhone = personDetails.filter((value) => {
                    return (value.phoneNo).toLowerCase() == phoneVal.toLowerCase();
                });
                const phonePattern = /^[0-9_+ -]{10,14}$/
                if(phonePattern.test(phoneVal) && phoneVal != '' && existingPhone.length == 0){
                    $('#phoneError').hide();
                    $('#phonrNumberInput').css('border','');
                }
                else{
                    $('#phoneError').html('Please enter valid number or check for already exist or not !').show();
                    $('#phonrNumberInput').css('border','1px solid red');
                    errorPhone = true;
                }
            }
            function checkAddress(addressVal) {
                const existingAddress = personDetails.filter((value) => {
                    return (value.address).toLowerCase() == addressVal.toLowerCase();
                });
                if(addressVal != '' && existingAddress.length == 0){
                    $('#addressError').hide();
                    $('#addressInput').css('border','');
                }
                else{
                    $('#addressError').html('Please enter address or check for already exist or not !').show();
                    $('#addressInput').css('border','1px solid red');
                    errorAddress = true;
                }
            }
            function checkDate(birthVal) {
                const existingBirthDate = personDetails.filter((value) => {
                    return (value.birthDate).toLowerCase() == birthVal.toLowerCase();
                });
                if(birthVal != '' && existingBirthDate.length == 0){
                    $('#dateError').hide();
                    $('#dobInput').css('border','');
                }
                else{
                    $('#dateError').html('Please enter date of birth or check for already exist or not !').show();
                    $('#dobInput').css('border','1px solid red');
                    errorDate = true;
                }
            }

            $('#detailsForm').submit(function(event) {
                event.preventDefault();

                errorFname = false;
                errorLname = false;
                errorEmail = false;
                errorPhone = false;
                errorAddress = false;
                errorDate = false;

                fName = $('#firstNameInput').val();
                lName = $('#lastNameInput').val();
                mailId = $('#emailInput').val();
                phoneNo = $('#phonrNumberInput').val();
                address = $('#addressInput').val();
                birthDate = $('#dobInput').val();

                checkFname(fName);
                checkLname(lName);
                checkEmail(mailId);
                checkPhone(phoneNo);
                checkAddress(address);
                checkDate(birthDate);

                if(errorFname == false && errorLname == false && errorEmail == false && errorPhone == false && errorAddress == false && errorDate == false){
                    // edit and submit edited value
                    if(editValue !== '' && forEditDataToggle == true){
                        let editArray = personDetails.map((val,ind) => {
                            if(ind == editIndex){
                                return {fName, lName, mailId, phoneNo, address, birthDate}
                            }
                            return val
                        })
                        $('.tableBody > tr#' + editIndex).replaceWith(handleSubmit(fName,lName,mailId,editIndex));
                        personDetails = editArray;
                        setLocalData();
                        modalClose();
                        clearInputValue();
                    }
                    // submit(add) value
                    else{
                        personObject = {fName, lName, mailId, phoneNo, address, birthDate};
                        personDetails.push(personObject);
                        submitDetails();
                        setLocalData();
                        modalClose();
                        clearInputValue();
                    }
                    return true
                }
                else{
                    return false
                }
            })
            // -------- form validation end ---------
            // display data in table - one time run
            function dataDisplay() {
                personDetails.map((val,ind) => {
                    const tableRow = $('<tr></tr>', {'id': ind}).append('<td>' + val.fName + ' ' + val.lName + '</td>' + 
                        '<td>' + val.mailId + '</td>'+
                        '<td class="text-end">'+
                            '<div class="btn-group btnClickable">' +
                            '<button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown"><i class="fa-solid fa-ellipsis"></i></button>' +
                                '<ul class="dropdown-menu">' +
                                    '<li><button class="dropdown-item editbtn" id=' + ind + '><i class="fa-solid fa-pen-clip text-success pe-2"></i>Edit</button></li>' +
                                    '<li><button class="dropdown-item deletebtn" id=' + ind + '><i class="fa-solid fa-trash-can text-danger pe-2"></i>Delete</button></li>' +
                                    '<li><hr class="dropdown-divider"></li>' +
                                    '<li><button class="dropdown-item viewbtn" id=' + ind + '><i class="fa-regular fa-eye text-primary pe-2"></i>View Details</button></li>' +
                                '</ul>' +
                            '</div>' +
                        '</td>'
                    );
                    $('.tableBody').append(tableRow);
                })
            }
            dataDisplay();
            // handlesubmit function for edit-submit repeated code
            function handleSubmit(firstName,lastName,emailId,indexNumber){
                return '<tr id='+ indexNumber +'>' +
                    '<td>' + firstName + ' ' + lastName + '</td>' + 
                    '<td>' + emailId + '</td>' +
                    '<td class="text-end">' +
                        '<div class="btn-group btnClickable">' +
                        '<button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown"><i class="fa-solid fa-ellipsis"></i></button>' +
                            '<ul class="dropdown-menu">' +
                                '<li><button class="dropdown-item editbtn" id=' + indexNumber + '><i class="fa-solid fa-pen-clip text-success pe-2"></i>Edit</button></li>' +
                                '<li><button class="dropdown-item deletebtn" id=' + indexNumber + '><i class="fa-solid fa-trash-can text-danger pe-2"></i>Delete</button></li>' +
                                '<li><hr class="dropdown-divider"></li>' +
                                '<li><button class="dropdown-item viewbtn" id=' + indexNumber + '><i class="fa-regular fa-eye text-primary pe-2"></i>View Details</button></li>' +
                            '</ul>' +
                        '</div>' +
                    '</td>' +
                '</tr>'
            }

            let fName = $('#firstNameInput').val();
            let lName = $('#lastNameInput').val();
            let mailId = $('#emailInput').val();
            let phoneNo = $('#phonrNumberInput').val();
            let address = $('#addressInput').val();
            let birthDate = $('#dobInput').val();
            // submit details
            function submitDetails() {
                getLocalData = JSON.parse(localStorage.getItem('person'));
                const index = getLocalData.length
                $('.tableBody').append(
                    handleSubmit(fName,lName,mailId,index)
                );
            }
            // for delete
            $('.tableBody').on('click','.deletebtn', function(event) {
                const index = event.target.id;
                const deleteIndex = personDetails.findIndex((value,ind) => {
                    return ind == index
                });
                $('.tableBody > tr#' + deleteIndex).remove();
                personDetails.splice(deleteIndex, 1);
                setLocalData();
                // updating index number after removed element.
                $('.tableBody > tr').each(function(ind,tr){
                    $(tr).attr('id',ind).find('.dropdown-item').attr('id',ind);
                })
            });
            //for get value in input field when click on edit button
            let editValue = '';
            let editIndex = '';
            $('.tableBody').on('click','.editbtn',function(event) {
                forEditDataToggle = true;
                const editInd = event.target.id;
                editIndex = personDetails.findIndex((value,ind) => {
                    return ind == editInd
                });
                editValue = personDetails.filter((value,ind) => {
                    return ind == editIndex
                });
                modalOpen();
                $('.submitButton').text('Save');
                $('#staticBackdropLabel').text('Edit Details');
                $('#firstNameInput').val(editValue[0].fName);
                $('#lastNameInput').val(editValue[0].lName);
                $('#emailInput').val(editValue[0].mailId);
                $('#phonrNumberInput').val(editValue[0].phoneNo);
                $('#addressInput').val(editValue[0].address);
                $('#dobInput').val(editValue[0].birthDate);
            });
            //for view
            $('.tableBody').on('click','.viewbtn',function(event) {
                const viewIndex = event.target.id;
                const viewValue = personDetails.filter((value,ind) => {
                    return ind == viewIndex
                });
                modalOpen();
                $('input').attr('readonly','readonly');
                $('#addressInput').attr('readonly','readonly');
                $('.submitButton').css('display','none');
                $('#staticBackdropLabel').text('View Details');
                $('#firstNameInput').val(viewValue[0].fName);
                $('#lastNameInput').val(viewValue[0].lName);
                $('#emailInput').val(viewValue[0].mailId);
                $('#phonrNumberInput').val(viewValue[0].phoneNo);
                $('#addressInput').val(viewValue[0].address);
                $('#dobInput').val(viewValue[0].birthDate);
            });
        })
    </script>
</body>
</html>